---
title: Next.js Docker 적용기
date: '2024-10-25'
tags: ['nextJS', 'devOps', 'docker']
draft: false
summary: Next.js로 개발한 프로젝트를 도커 이미지로 만들게 되었는데, 이와 관련해서 작성해봤습니다.
---

## 서론

지난 번 게시글에서는 환경변수 관련해서 글을 작성했었죠, 그것은 이번 글을 위한 빌드업 같은 느낌으로 이해해주시면 될 것 같습니다. 이번 글에서는 본격적으로 패키징을 해서 패키지화(제품화) 시켰던 경험을 작성해보려고 합니다.

## Debian VS Docker

### Debian

`Debian`을 사용하여 사내 레포지토리에 올려놓는다면 `sudo apt-get install [package_name]`으로 패키지 설치가 가능합니다. 다만 이후에 `conf`를 할당해주거나 이외의 서버 환경에 맞는 커스텀은 설치하는 사람이 담당해야 한다는 단점이 존재하죠. 어차피 `Ubuntu` 기반 서버에 설치될 것이기 때문에 요구사항은 `Debian` 설치를 하는 방향으로 들어왔습니다. 그래서 아래와 같이 구조를 짜고, 설치 스크립트를 고민중이었습니다.

```bash
build/
├── deb/
│   ├── DEBIAN/
│   │   ├── control
│   │   └── postinst
│   ├── Makefile
│   ├── product.deb
│   └── opt/
│       └── company/
│           ├── etc/
│           │   └── product/
│           │       ├── cert/
│           │       └── conf/
│           │           ├── product.nginx.conf
│           │           └── setting.sh
│           └── lib/
│               └── product/
│                   ├── .next/
│                   ├── nextconfig.js
│                   ├── package.json
│                   ├── node_modules/
│                   ├── ecosystem.config.js
│                   ├── config.json
│                   └── .env
├── conf/
│   └── product.nginx.conf
└── target/
    ├── .next/
    ├── next.config.js
    ├── package.json
    ├── node_modules/
    ├── config.json
    ├── .env
    └── setting.sh
```

그러나 이렇게 설치를 하게 되면 서버가 돌기 위해 신경써야 할 요소들이 많습니다. `Next` 서버가 돌기 위해 `next.config.js`, `package.json`, `node_modules` 등등 경로 설정 같은 것들도 신경써야 하죠. 거기다 다른 프로젝트들까지 동시에 설치가 될 예정인데, 아무리 `depth`를 파서 설치를 한다고 하더라도 비개발자에게 설치를 시키기에는 구조가 복잡했습니다.

### Docker

<section className={"flex items-center justify-center my-[-10px]"}>
  <img src="/static/images/posts/docker.png" alt="Docker Image" className={"w-1/2"} />
</section>


반면 `Docker`를 쓴다면 이야기가 다릅니다. 저러한 구성 그대로 이미지의 형태를 만들게 된다면 서버의 레포지토리가 아닌 하나의 도커 컨테이너로써 구동 되기 때문에 독립된 `OS`를 사용하는 형식이 됩니다. `Debian`과는 다르게 `/opt/company`에 들어가봐도 아무것도 존재하지 않게 된다는 말이죠. 이외에도 여러가지 이점이 있기도 하고, 이참에 한 번 공부해봐야겠다 싶어서 `도커 씁시다`라고 제안했고, 수용되었습니다.

## Docker Image

### 생성 과정

우선 도커를 사용하기로 결정했다면 어떻게 이미지로 만들지부터 생각을 해야합니다.